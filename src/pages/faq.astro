---
// src/pages/faq.astro
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/blocks/Hero.astro';
import CTA from '../components/blocks/CTA.astro';

const pageTitle = 'FAQ - Частые вопросы об установке окон';
const pageDescription = 'Ответы на частые вопросы о пластиковых окнах: установка, ремонт, цены, гарантия. Профессиональная консультация от UWS.';

// FAQ data organized by categories
const faqCategories = [
  {
    name: 'Общие вопросы',
    icon: 'question',
    faqs: [
      {
        question: 'Какой профиль лучше выбрать - REHAU, KBE или WDS?',
        answer: 'Все три производителя - лидеры оконного рынка. REHAU - премиум сегмент с лучшей теплоизоляцией. KBE - оптимальное соотношение цены и качества. WDS - бюджетный вариант с достойными характеристиками. Мы поможем подобрать профиль под ваши задачи и бюджет.'
      },
      {
        question: 'Сколько времени занимает установка одного окна?',
        answer: 'Установка одного стандартного окна занимает от 2 до 4 часов. Замена окон в квартире с 2-3 комнатами выполняется за 1-2 дня. Мы всегда согласовываем сроки заранее и соблюдаем договорённости.'
      },
      {
        question: 'Можно ли установить окна зимой?',
        answer: 'Да, современные технологии позволяют устанавливать окна в любое время года. Мы используем специальные зимние монтажные материалы, которые работают при температуре до -15°C. Процесс установки занимает около 30-40 минут на одно окно, поэтому квартира не успевает охладиться.'
      },
      {
        question: 'Как выбрать правильный размер окна?',
        answer: 'Для точного замера лучше вызвать нашего инженера - это бесплатно. Он измерит проём, учтёт особенности стен, посоветует оптимальную конфигурацию окна и рассчитает точную стоимость.'
      }
    ]
  },
  {
    name: 'Стоимость и оплата',
    icon: 'money',
    faqs: [
      {
        question: 'Сколько стоит пластиковое окно?',
        answer: 'Стоимость окна зависит от размеров, типа профиля, стеклопакета и фурнитуры. Средняя цена качественного двухстворчатого окна - от 8000 до 15000 грн. Точный расчёт можно получить после бесплатного замера или использовать наш онлайн-калькулятор.'
      },
      {
        question: 'Делаете ли вы бесплатный замер?',
        answer: 'Да, замер в пределах Киева бесплатный. Наш инженер приедет в удобное для вас время, сделает точные замеры, проконсультирует по выбору окон и рассчитает точную стоимость. Замер обычно занимает 30-40 минут.'
      },
      {
        question: 'Какие есть способы оплаты?',
        answer: 'Оплата производится в два этапа: 50% предоплата при заключении договора, 50% после завершения монтажа и приёмки работ. Возможна оплата наличными, безналичным расчётом, через терминал или рассрочка на 6-12 месяцев.'
      },
      {
        question: 'Есть ли скрытые платежи?',
        answer: 'Нет, мы работаем честно. Окончательная цена фиксируется в договоре и включает: стоимость окон, доставку, подъём на этаж, монтаж, демонтаж старых окон и вывоз мусора. Никаких дополнительных платежей не будет.'
      }
    ]
  },
  {
    name: 'Гарантия и сервис',
    icon: 'shield',
    faqs: [
      {
        question: 'Какая гарантия на окна?',
        answer: 'Мы предоставляем официальную гарантию 5 лет на все виды работ и материалы. Профили REHAU и KBE имеют собственную гарантию производителя до 50 лет на профиль и до 10 лет на стеклопакеты. На фурнитуру - гарантия 2 года.'
      },
      {
        question: 'Что входит в гарантийное обслуживание?',
        answer: 'Гарантия покрывает: дефекты профиля, проблемы со стеклопакетом (потеря герметичности), неисправности фурнитуры, нарушение монтажных швов. При обнаружении проблемы мы бесплатно устраним дефект.'
      },
      {
        question: 'Как происходит гарантийный ремонт?',
        answer: 'При обнаружении проблемы звоните нам по телефону. Мы отправим мастера для диагностики. Если проблема гарантийная - ремонт бесплатный. Обычно мелкий ремонт выполняется в день обращения, крупный - в течение 3-5 дней.'
      },
      {
        question: 'Можно ли продлить гарантию?',
        answer: 'Да, мы предлагаем расширенную гарантию на 10 лет, которая включает ежегодное техническое обслуживание окон. Это продлевает срок службы окон и экономит деньги на ремонте.'
      }
    ]
  },
  {
    name: 'Технические вопросы',
    icon: 'tools',
    faqs: [
      {
        question: 'Чем отличается однокамерный стеклопакет от двухкамерного?',
        answer: 'Двухкамерный стеклопакет состоит из трёх стёкол и двух воздушных камер, что обеспечивает лучшую тепло- и звукоизоляцию. Однокамерный - два стекла и одна касса. Для Киева и квартир рекомендуем двухкамерный пакет.'
      },
      {
        question: 'Что такое энергосберегающее стекло?',
        answer: 'Это стекло с низкоэмиссионным (i-) покрытием, которое отражает тепло обратно в помещение. Позволяет снизить теплопотери на 40% и экономить на отоплении зимой. Стоит немного дороже, но окупается за 2-3 года.'
      },
      {
        question: 'Какая фурнитура лучше?',
        answer: 'Премиум сегмент: ROTO NT, MACO, Siegenia TITAN - надёжные, долговечные, плавный ход. Стандарт: Elementis, Aubi - хорошее соотношение цены и качества. Мы рекомендуем ROTO NT - проверенный выбор с 10-летним опытом.'
      },
      {
        question: 'Нужно ли утеплять откосы?',
        answer: 'Да, утеплённые откосы предотвращают появление конденсата и плесени, улучшают теплоизоляцию и внешний вид окна. Мы рекомендуем сэндвич-панели с утеплением - это современное и эстетичное решение.'
      }
    ]
  },
  {
    name: 'Балконы',
    icon: 'balcony',
    faqs: [
      {
        question: 'Какое остекление балкона лучше - тёплое или холодное?',
        answer: 'Тёплое остекление (ПВХ) - для использования балкона как дополнительной комнаты круглый год. Холодное (алюминий) - для защиты от осадков и пыли, если балкон используется как склад. Мы поможем выбрать оптимальный вариант.'
      },
      {
        question: 'Сколько стоит остекление балкона?',
        answer: 'Холодное остекление алюминием - от 8000 грн. Тёплое ПВХ остекление - от 15000 грн. Полная отделка балкона под ключ - от 25000 грн. Точная цена после бесплатного замера.'
      },
      {
        question: 'Нужно ли разрешение на остекление балкона?',
        answer: 'Для остекления балкона разрешение не требуется, если не меняется фасад здания. Однако рекомендуем согласовать с управляющей компанией. Мы поможем с оформлением документов при необходимости.'
      }
    ]
  },
  {
    name: 'Ремонт окон',
    icon: 'wrench',
    faqs: [
      {
        question: 'Почему дует из окна?',
        answer: 'Основные причины: износ уплотнителя, неплотное прилегание створки, нарушение монтажных швов, деформация профиля. Наш мастер быстро найдёт причину и устранит проблему. Ремонт часто занимает 1-2 часа.'
      },
      {
        question: 'Окно не закрывается - что делать?',
        answer: 'Скорее всего, нужна регулировка фурнитуры или перевод створки в зимний режим. Если это не помогает - может потребоваться замена уплотнителя или регулировка петель. Вызовите мастера для диагностики.'
      },
      {
        question: 'Как часто нужно менять уплотнитель?',
        answer: 'Качественный уплотнитель служит 5-10 лет. Признаки необходимости замены: появление сквозняков, ухудшение звукоизоляции, видимые трещины или деформация. Мы рекомендуем проверять состояние уплотнителя ежегодно.'
      },
      {
        question: 'Сколько стоит ремонт окна?',
        answer: 'Регулировка и мелкий ремонт - от 500 грн. Замена уплотнителя - от 800 грн. Замена фурнитуры - от 1500 грн. Замена стеклопакета - от 2500 грн. Точная цена после диагностики.'
      }
    ]
  }
];

const iconMap: Record<string, string> = {
  question: 'M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z',
  money: 'M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11-.402-2.599-1-3-1',
  shield: 'M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z',
  tools: 'M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z',
  balcony: 'M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064',
  wrench: 'M15.732 5.848a3.001 3.001 0 0 0-2.122-1.263A3.01 3.01 0 0 0 9.5 4a3.01 3.01 0 0 0-4.11.268A3 3 0 0 0 3.5 7.5a3.01 3.01 0 0 0 4.11 5.122 3.01 3.01 0 0 0 3.5 8.5a3.01 3.01 0 0 0 4.11-.268 3 3 0 0 0 2.122-2.263 3.01 3.01 0 0 0 2.122-2.263A3.01 3.01 0 0 0 17.5 4a3.01 3.01 0 0 0-1.768-2.152z M13.5 15.5a3 3 0 1 0-6 0 3 3 0 0 0 6 0z'
};
---

<BaseLayout 
  title={pageTitle}
  description={pageDescription}
>
  <Hero
    title="Частые вопросы"
    subtitle="Ответы на самые популярные вопросы об установке и ремонте окон. Не нашли ответ? Свяжитесь с нами!"
    variant="dark"
  />

  <!-- Search -->
  <section class="section bg-gray-50 dark:bg-gray-900">
    <div class="container">
      <div class="max-w-2xl mx-auto">
        <div class="relative">
          <input
            type="text"
            id="faq-search"
            placeholder="Поиск по вопросам..."
            class="w-full px-6 py-4 pr-12 rounded-full border border-gray-300 focus:ring-2 focus:ring-brand-yellow focus:border-transparent dark:bg-gray-700 dark:border-gray-600 dark:text-white"
          />
          <svg class="absolute right-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Categories -->
  <section class="section">
    <div class="container">
      <div class="space-y-12">
        {faqCategories.map((category) => (
          <div class="category-section">
            <div class="flex items-center gap-3 mb-6">
              <div class="w-10 h-10 bg-brand-yellow/20 rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 text-brand-yellow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={iconMap[category.icon]} />
                </svg>
              </div>
              <h2 class="text-2xl font-heading font-bold dark:text-white">{category.name}</h2>
            </div>
            
            <div class="space-y-4">
              {category.faqs.map((faq, index) => (
                <details 
                  class="group bg-white rounded-xl overflow-hidden shadow-lg dark:bg-gray-800"
                  data-search={`${faq.question.toLowerCase()} ${faq.answer.toLowerCase()}`}
                >
                  <summary class="flex items-center justify-between p-6 cursor-pointer list-none">
                    <h3 class="text-lg font-semibold pr-4 dark:text-white">{faq.question}</h3>
                    <svg 
                      class="w-6 h-6 text-brand-yellow transform group-open:rotate-180 transition-transform flex-shrink-0"
                      fill="none" 
                      stroke="currentColor" 
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                    >
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </summary>
                  <div class="px-6 pb-6 text-gray-600 dark:text-gray-400 border-t dark:border-gray-700 pt-4">
                    <p>{faq.answer}</p>
                  </div>
                </details>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA -->
  <CTA
    title="Не нашли ответ на вопрос?"
    subtitle="Наши специалисты готовы ответить на любые вопросы и помочь с выбором окон"
    ctaText="Задать вопрос"
    ctaLink="/contacts"
    showForm={true}
  />
</BaseLayout>

<script>
  // FAQ Search functionality
  const searchInput = document.getElementById('faq-search') as HTMLInputElement;
  const categorySections = document.querySelectorAll('.category-section');

  searchInput?.addEventListener('input', (e) => {
    const query = (e.target as HTMLInputElement).value.toLowerCase();
    
    categorySections.forEach((section) => {
      const faqs = section.querySelectorAll('details');
      let hasVisibleFAQs = false;
      
      faqs.forEach((faq) => {
        const searchText = faq.getAttribute('data-search') || '';
        const isVisible = query === '' || searchText.includes(query);
        (faq as HTMLElement).style.display = isVisible ? 'block' : 'none';
        if (isVisible) hasVisibleFAQs = true;
      });
      
      (section as HTMLElement).style.display = hasVisibleFAQs || query === '' ? 'block' : 'none';
    });
  });
</script>
